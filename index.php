<?phprequire_once 'db.php';//@require_once 'security.php';$aPages = array(//	'lg' => 'showleague.php',//	'lg0' => 'showleague0.php',	'pl' => 'showplayer.php',//	's' => 'players.php',	'a' => 'showleague.php',	'b' => 'showleague.php',	'c' => 'showleague.php',	'n' => 'showleague.php',	'g' => 'showgames.php',/*	2 => 'graphs.php',	1 => 'statsfull.php',	3 => 'statsranked_00.php',	4 => 'gameslist.php',*/	1 => 'showleague.php',	'lg' => 'showleagues.php',	'cron' => 'cron.php',	'log' => 'log.php',	'ban' => 'banplayer.php',	'info' => 'info.php');$aTitles = array(	'a' => 'A league',	'b' => 'B league',	'c' => 'C league',	'n' => 'New players',/*	1 => 'Complete ranking',	2 => 'Graphs',	3 => 'Season 0 ranking',	4 => 'Games list',*/	'pl' => 'Player details',	'lg' => 'Leagues list',	'ban' => 'Banned!',	'info' => 'Info');// current pages, should be gathered from db$aAdd = array(	'a' => '13',	'b' => '12',	'c' => '11',	'n' => '10',	1 => 's4',	'g' => '4');if (isset($_GET['i'])) $aAdd['pl'] = $_GET['i'];if (isset($_GET['i'])) $aAdd['ban'] = $_GET['i'];if (isset($_GET['l'])) $aExtra['ban'] = $_GET['l'];/*if ($isadmin) {    $aTitles['lga'] = 'Leagues list';}*/$stmt = $dbh->prepare('SELECT lid,lname FROM yleagues ORDER BY lname');// SELECT lid,lname,(enddate<now()-INTERVAL '1 day') AS ended FROM yleagues NATURAL JOIN yseasons ORDER BY lname$stmt->execute();$leagues = $stmt->fetchAll();foreach ($leagues as $league) {//league list  $aPages['l'.$league['lid']] = 'showleague.php';  $aAdd['l'.$league['lid']] = $league['lid'];  $aTitles['l'.$league['lid']] = $league['lname'];}$stmt = $dbh->prepare('SELECT sid,sname FROM yseasons ORDER BY sid');// SELECT lid,lname,(enddate<now()-INTERVAL '1 day') AS ended FROM yleagues NATURAL JOIN yseasons ORDER BY lname$stmt->execute();$seasons = $stmt->fetchAll();foreach ($seasons as $season) {//gameslist  $aPages['s'.$season['sid']] = 'showgames.php';  $aAdd['s'.$season['sid']] = $season['sid'];  $aTitles['s'.$season['sid']] = $season['sname'];}$iPage = isset($_GET['p']) ? $_GET['p'] : 1;$showplayersearch = ($iPage == 4 || $iPage[0] == 's' || $iPage == 'pl');?><!DOCTYPE html><html lang="en-us">	<head>		<title>Yazphier's local copy of WAML ranking<?php echo (isset($aTitles[$iPage]) ? ' | ' . $aTitles[$iPage] : ''); ?></title>		<meta charset="utf-8" />		<meta name="viewport" content="width=device-width" />		<meta name="description" content="World Amateur Mahjong League ranking page" />		<link href="css/bootstrap.min.css" rel="stylesheet" media="screen" />		<link href="css/bootstrap-responsive.min.css" rel="stylesheet" media="screen" />				<script src="http://code.jquery.com/jquery-latest.js"></script>		<script src="js/bootstrap.min.js"></script>		<script src="js/highcharts.js" type="text/javascript"></script>			<script type="text/javascript" src="js/jquery.tablesorter.js"></script> 				<script type="text/javascript">		  $(function() {			$('#plsearch').val('').keyup(function() {				player = $(this).val();								if (player != '') {					$('.table tbody tr td').attr('style', '');					$('.table tbody tr').each(function() {						names = $(this).find('strong');						found = false;						for (i = 0; i < names.length; i++) {							if ($(names[i]).html().indexOf(player) === 0) {								found = true;								$(names[i]).parent().attr('style', 'background-color: #FFE019;');								break;							}						}												if (!found) {							$(this).hide();						} else {							$(this).show();						}					});				} else {					$('.table tbody tr').show();					$('.table tbody tr td').attr('style', '');				}			});						$('.plsearchform').submit(function(e) {				e.preventDefault();			});						$('#only_ranked').change(function() {				if ($(this).is(':checked')) {					$('.table tbody tr').not('.ranked').hide();				} else {					$('.table tbody tr').show();				}								i = 1;				$('.table tbody tr td:first-child').each(function() {					if ($(this).parent().is(':visible')) {						$(this).html(i++);					}				});			});		  });						  var _gaq = _gaq || [];		  _gaq.push(['_setAccount', 'UA-4431621-4']);		  _gaq.push(['_trackPageview']);		  (function() {			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);		  })();		</script>						<style type="text/css">			table.table.table-striped.table-condensed.tablesorter th:nth-child(5) {				text-align: center;			}					table.table.table-striped.table-condensed tr.ranked td:nth-child(4) {				background-color: #35D4A4;			}						table.table.table-striped.table-condensed tr td.league_A,			table.table.table-striped.table-condensed tr td.league_B,			table.table.table-striped.table-condensed tr td.league_C,			table.table.table-striped.table-condensed tr td.league_N {				text-align: center;				font-weight: bold;			}						table.table.table-striped.table-condensed tr td.league_A {				background-color: #339966;			}			table.table.table-striped.table-condensed tr td.league_B {				background-color: #ff9900;			}			table.table.table-striped.table-condensed tr td.league_C {				background-color: #ff6600;			}						table.tablesorter th {				cursor: pointer;			}						.mainbody {				margin-top: 10px;			}						td span.league {				padding-left: 5px;				padding-right: 5px;				margin-left: 5px;				border: 1px solid #000;				text-decoration: none;			}						span.league.l_A {				background-color: #339966;			}			span.league.l_B {				background-color: #ff9900;			}			span.league.l_C {				background-color: #ff6600;			}						.table-striped tbody tr td.ban { 				background-color: #FF3333;				text-decoration: line-through;			}						.table-striped tbody tr.zerogames td {				color: gray;				background-color: silver;			}			.table-striped tbody tr.ban td {				color: gray;				background-color: silver;				text-decoration: line-through;			}		</style>	</head>	<body>		<div class="navbar navbar-inverse navbar-static-top">			<div class="navbar-inner">				<div class="container">					<a class="brand" href="index.php">WAML Ranking (Season 3)</a>					<ul class="nav">						<li class="<?php echo ($iPage == 'a' ? 'active' : ''); ?>"><a href="index.php?p=a">A</a></li>						<li class="<?php echo ($iPage == 'b' ? 'active' : ''); ?>"><a href="index.php?p=b">B</a></li>						<li class="<?php echo ($iPage == 'c' ? 'active' : ''); ?>"><a href="index.php?p=c">C</a></li>						<li class="<?php echo ($iPage == 'n' ? 'active' : ''); ?>"><a href="index.php?p=n">N</a></li>						<li class="divider-vertical"></li>						<li class="<?php echo ($iPage == 1 ? 'active' : ''); ?>"><a href="index.php?p=1">Full</a></li>						<li class="<?php echo ($iPage == 'g' ? 'active' : ''); ?>"><a href="index.php?p=g">Games</a></li>						<li class="<?php echo ($iPage == 2 ? 'active' : ''); ?>"><a href="index.php?p=2">Graphs</a></li>						<li class="<?php echo ($iPage == 'lg' ? 'active' : ''); ?>"><a href="index.php?p=lg">Leagues</a></li>						<li class="<?php echo ($iPage == 'info' ? 'active' : ''); ?>"><a href="index.php?p=info">?</a></li>					</ul>					<ul class="nav pull-right">						<li class="divider-vertical"></li>						<li class="dropdown">							<a class="dropdown-toggle" data-toggle="dropdown" href="#">								Games								<b class="caret"></b>							</a>							<ul class="dropdown-menu"><?php foreach ($seasons as $season) { ?>							    <li><a href="index.php?p=s<?php echo $season['sid']?>">Games <?php echo $season['sname'];?></a></li><?php } ?>							</ul>						</li>						<li class="dropdown">							<a class="dropdown-toggle" data-toggle="dropdown" href="#">								Leagues								<b class="caret"></b>							</a>							<ul class="dropdown-menu"><?php foreach ($leagues as $league) { ?>							    <li><a href="index.php?p=l<?php echo $league['lid']?>"><?php echo $league['lname'];?></a></li><?php }//if ($isadmin) echo '<li><a href="index.php?p=lga">Leagues admin</a></li>';?>							</ul>						</li><?php/*						<li class="dropdown <?php echo ($iPage == 3 ? 'active' : ''); ?>">							<a class="dropdown-toggle" data-toggle="dropdown" href="#">								History								<b class="caret"></b>							</a>							<ul class="dropdown-menu">								<li><a href="index.php?p=3">Season 0</a></li>								<li><a href="index.php?p=5">Season 1 A</a></li>								<li><a href="index.php?p=6">Season 1 B</a></li>								<li><a href="index.php?p=7">Season 1 C</a></li>								<li><a href="index.php?p=8">Season 1 N</a></li>								<li><a href="index.php?p=9">Season 2 A</a></li>								<li><a href="index.php?p=10">Season 2 B</a></li>								<li><a href="index.php?p=11">Season 2 C</a></li>								<li><a href="index.php?p=12">Season 2 N</a></li>															</ul>						</li>*/?>						<li class="dropdown">							<a class="dropdown-toggle" data-toggle="dropdown" href="#">								Links								<b class="caret"></b>							</a>							<ul class="dropdown-menu">								<li><a href="http://www.mahjong-league.com">Blog</a></li>								<li><a href="http://tenhou.net/0/?L7447">7447 lobby</a></li>								<li><a href="http://tenhou.net/0/?59295224">Secure lobby</a></li>								<li><a href="irc://irc.rizon.net/osamuko">#osamuko</a></li>								<li><a href="http://www.twitch.tv/kirowind">Kirowind Stream</a></li>							</ul>													</li>											</ul>				</div>			</div>		</div>		<div class="container mainbody">			<div class="row">				<div class="span12">				<p>Info at ? in menu</p>				<hr />								<?php					// games list filter					if ($showplayersearch) {					?>						<div style="overflow: hidden;">							<form class="form-inline pull-right plsearchform">								<fieldset>																		<input type="text" placeholder="Find player..." id="plsearch" />								</fieldset>							</form>						</div>					<?php					}										if (isset($aAdd[$iPage])) {$_GET['add'] = $aAdd[$iPage];//					    echo $aTitles[$iPage];//					    echo $_SERVER['REMOTE_ADDR'];					}					if (isset($aExtra[$iPage])) $_GET['extra'] = $aExtra[$iPage];					@include $aPages[$iPage];									?>				</div>						</div>		</div>				<script type="text/javascript">		$(document).ready(function() { 			$("table.tablesorter").tablesorter({				sortInitialOrder: "desc"			}); 		}); 		</script>	</body></html>