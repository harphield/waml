<?phprequire_once 'db.php';$league = $_GET['add'];$wholeseason = false;//$season = $_GET['season']; if (!is_numeric($league)) {    if ($league[0] == 's') {      $wholeseason = true;      $sid = substr($league,1);      if (!is_numeric($sid))	{	$sid = 1;      }    } else $league = 1;}/*//$stmt = $dbh->prepare('SELECT max(scupdated) AS update, count (DISTINCT pid) AS players, count(DISTINCT gid) AS games FROM yseasonscore NATURAL JOIN yseasongames NATURAL JOIN yleagues WHERE lid=:league');//SELECT max(scupdated), count (pid) FROM yseasonscore WHERE lid=:league');//SELECT max(scupdated), count (pid), (SELECT count(gid) FROM yseasongames WHERE sid=1) FROM yseasonscore WHERE lid=1;$stmt->bindParam(':league', $league);$stmt->execute();$players = $stmt->fetch();echo $players['players'] . ' Players (league) in ' . $players['games'] . ' games (season)<BR>';echo 'Last updated: '. $players['update'] . '<BR>';*/if (!$wholeseason) {  $stmt = $dbh->prepare('SELECT count(gid) AS games FROM yseasongames WHERE sid=(SELECT sid FROM yleagues WHERE lid=:league)');  $stmt->bindParam(':league', $league);  $stmt->execute();  $players = $stmt->fetch();  $games = $players['games'];  $stmt = $dbh->prepare('SELECT max(scupdated) AS updated FROM yseasonscore WHERE lid=:league');  $stmt->bindParam(':league', $league);  $stmt->execute();  $players = $stmt->fetch();  $updated = $players['updated'];  $stmt = $dbh->prepare('SELECT lname,lshort FROM yleagues WHERE lid=:league');  $stmt->bindParam(':league', $league);  $stmt->execute();  $players = $stmt->fetch();  $lshort = $players['lshort'];  $lname = $players['lname'];  $stmt = $dbh->prepare('SELECT uid,name, COALESCE(scpoints,0) AS scpoints,     COALESCE(scgames,0) AS scgames, COALESCE(scfirst,0) AS scfirst,     COALESCE(scsecond,0) AS scsecond, COALESCE(scthird,0) AS scthird,    COALESCE(scfourth,0) AS scfourth, banned FROM yseasonscore NATURAL RIGHT JOIN yseasonplayers NATURAL JOIN yplayers NATURAL JOIN users    WHERE lid=:league ORDER BY scpoints DESC');//AND scgames >= 20 COALESCE(nullCOALESCE(null/*  SELECT name, scpoints, scgames,  scfirst, scsecond, scthird, scfourth FROM yseasonscore NATURAL JOIN yplayers   WHERE lid=:league ORDER BY scpoints DESC*//*$stmt = $dbh->prepare('SELECT name, scpoints, scgames,  scfirst, scsecond, scthird, scfourth FROM yseasonscore NATURAL JOIN yplayers   WHERE lid=:league ORDER BY scpoints DESC LIMIT 2');*/  $stmt->bindParam(':league', $league);} else {  $stmt = $dbh->prepare('SELECT count(gid) AS games FROM yseasongames WHERE sid=:sid');  $stmt->bindParam(':sid', $sid);  $stmt->execute();  $players = $stmt->fetch();  $games = $players['games'];  $stmt = $dbh->prepare('SELECT max(scupdated) AS updated FROM yseasonscore WHERE lid IN (SELECT lid FROM yleagues WHERE sid=:sid)');  $stmt->bindParam(':sid', $sid);  $stmt->execute();  $players = $stmt->fetch();  $updated = $players['updated'];  $stmt = $dbh->prepare('SELECT lname,lshort,lid FROM yleagues WHERE lid IN (SELECT lid FROM yleagues WHERE sid=:sid)');  $stmt->bindParam(':sid', $sid);  $stmt->execute();  $players = $stmt->fetchAll();  foreach ($players as $player) {    $lshort[$player['lid']] = $player['lshort'];    $lname[$player['lid']] = $player['lname'];  }  $stmt = $dbh->prepare('SELECT uid,name,lid,COALESCE(scpoints,0) AS scpoints,     COALESCE(scgames,0) AS scgames, COALESCE(scfirst,0) AS scfirst,     COALESCE(scsecond,0) AS scsecond, COALESCE(scthird,0) AS scthird,    COALESCE(scfourth,0) AS scfourth, banned FROM yseasonscore NATURAL RIGHT JOIN yseasonplayers NATURAL JOIN yplayers NATURAL JOIN users    WHERE lid IN (SELECT lid FROM yleagues WHERE sid=:sid) ORDER BY scpoints DESC');  $stmt->bindParam(':sid', $sid);}$stmt->execute();if ($stmt->rowCount() > 0) {	$players = $stmt->fetchAll();//echo $players[1]['scsecond'];//	var_dump($players);} else {$players = null;}?><div style="overflow: hidden; margin-bottom: 10px;">	<div style="float: left;">Games played: <?php echo $games; ?></div> 	<div style="float: right;">	<label class="checkbox">		<input type="checkbox" id="only_ranked" /> Show only ranked	</label></div></div>					<table class="table table-striped table-condensed tablesorter">	<thead>	<tr>		<th>#</th>		<th>Player</th>		<th>Points</th>		<th>Games</th>		<th class="centered">League</th>		<th>PPG</th>		<th>1st%</th>		<th>2nd%</th>		<th>3rd%</th>		<th>4th%</th>		<th>Avg</th>	</tr>	</thead>	<tbody>	<?php 	$i = 1;//	while ($player = $stmt->fetch()) {	foreach ($players as $player) {	  if ($league==1) //league 00 special	    if ($i>31) if ($i>70) $lshort='C'; else $lshort='B'; else $lshort='A';?>		<tr<?php if ($player['scgames'] > 19) echo ' class="ranked"';		     elseif ($player['banned']) echo ' class="ban"';		     elseif ($player['scgames'] == 0) echo ' class="zerogames"'; ?>>			<td><?php echo $i++; ?></td>			<td><a href="index.php?p=pl&i=<?php echo $player['uid'];			  ?>"><?php echo htmlspecialchars($player['name']) . $stars; ?></a></td>			<td><?php echo $player['scpoints']; ?></td>			<td><?php echo $player['scgames']; ?></td><?php if (!$wholeseason) {?>			<td class="league_<?php echo $lshort; ?>"><?php echo $lshort; ?></td><?php } else { ?>			<td class="league_<?php echo $lshort[$player['lid']]; ?>"><?php echo $lshort[$player['lid']]; ?></td><?php } ?>			<td><?php if ($player['scgames'] > 0) echo round($player['scpoints'] / $player['scgames'], 2); ?></td>			<td><?php if ($player['scgames'] > 0) echo round($player['scfirst'] / ($player['scgames'] / 100),2); ?></td>			<td><?php if ($player['scgames'] > 0) echo round($player['scsecond'] / ($player['scgames'] / 100),2); ?></td>			<td><?php if ($player['scgames'] > 0) echo round($player['scthird'] / ($player['scgames'] / 100),2); ?></td>			<td><?php if ($player['scgames'] > 0) echo round($player['scfourth'] / ($player['scgames'] / 100),2); ?></td>			<td><?php if ($player['scgames'] > 0) echo round(($player['scfirst']+$player['scsecond']*2+$player['scthird']*3+$player['scfourth']*4) / $player['scgames'], 2); ?></td>		</tr><?php	}	?>		</tbody></table><?php echo $updated;?>